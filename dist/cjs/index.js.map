{
  "version": 3,
  "sources": ["index.js"],
  "sourcesContent": ["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.derived = exports.effect = exports.use = void 0;\nvar _root = null;\nvar signalProto = {\n    set: function (newValue) {\n        this._value = newValue;\n        this._subscribers.forEach(function (callback) { return callback(); });\n    },\n    subscribe: function (callback) {\n        var _this = this;\n        this._subscribers.push(callback);\n        return function () {\n            _this._subscribers.splice(_this._subscribers.indexOf(callback), 1);\n        };\n    },\n    destroy: function () { },\n    valueOf: function () {\n        return this();\n    },\n    toString: function () {\n        return \"\".concat(this());\n    }\n};\nfunction use(initialValue) {\n    var signal = function () {\n        if (_root !== null)\n            _root.push(this);\n        return this._value;\n    };\n    Object.assign(signal, signalProto, {\n        _value: initialValue,\n        _subscribers: []\n    });\n    return signal;\n}\nexports.use = use;\nfunction withRoot(fn) {\n    var oldRoot = _root;\n    _root = [];\n    var ret = fn();\n    var newRoot = _root;\n    _root = oldRoot;\n    return { signals: newRoot, ret: ret };\n}\nfunction effect(callback) {\n    var signals = withRoot(callback).signals;\n    var unsubscribers = signals.map(function (signal) { return signal.subscribe(callback); });\n    return function () { return unsubscribers.forEach(function (unsubscribe) { return unsubscribe(); }); };\n}\nexports.effect = effect;\nfunction derived(deriveFn) {\n    var _a = withRoot(deriveFn), signals = _a.signals, ret = _a.ret;\n    var signal = use(ret);\n    var callback = function () { return signal.set(deriveFn()); };\n    var unsubscribers = signals.map(function (signal) { return signal.subscribe(callback); });\n    signal.destroy = function () { return unsubscribers.forEach(function (unsubscribe) { return unsubscribe(); }); };\n    return signal;\n}\nexports.derived = derived;\n"],
  "mappings": "aACA,OAAO,eAAe,QAAS,aAAc,CAAE,MAAO,EAAK,CAAC,EAC5D,QAAQ,QAAU,QAAQ,OAAS,QAAQ,IAAM,OACjD,IAAI,MAAQ,KACR,YAAc,CACd,IAAK,SAAUA,EAAU,CACrB,KAAK,OAASA,EACd,KAAK,aAAa,QAAQ,SAAUC,EAAU,CAAE,OAAOA,EAAS,CAAG,CAAC,CACxE,EACA,UAAW,SAAUA,EAAU,CAC3B,IAAIC,EAAQ,KACZ,YAAK,aAAa,KAAKD,CAAQ,EACxB,UAAY,CACfC,EAAM,aAAa,OAAOA,EAAM,aAAa,QAAQD,CAAQ,EAAG,CAAC,CACrE,CACJ,EACA,QAAS,UAAY,CAAE,EACvB,QAAS,UAAY,CACjB,OAAO,KAAK,CAChB,EACA,SAAU,UAAY,CAClB,MAAO,GAAG,OAAO,KAAK,CAAC,CAC3B,CACJ,EACA,SAAS,IAAIE,EAAc,CACvB,IAAIC,EAAS,UAAY,CACrB,OAAI,QAAU,MACV,MAAM,KAAK,IAAI,EACZ,KAAK,MAChB,EACA,cAAO,OAAOA,EAAQ,YAAa,CAC/B,OAAQD,EACR,aAAc,CAAC,CACnB,CAAC,EACMC,CACX,CACA,QAAQ,IAAM,IACd,SAAS,SAASC,EAAI,CAClB,IAAIC,EAAU,MACd,MAAQ,CAAC,EACT,IAAIC,EAAMF,EAAG,EACTG,EAAU,MACd,aAAQF,EACD,CAAE,QAASE,EAAS,IAAKD,CAAI,CACxC,CACA,SAAS,OAAON,EAAU,CACtB,IAAIQ,EAAU,SAASR,CAAQ,EAAE,QAC7BS,EAAgBD,EAAQ,IAAI,SAAUL,EAAQ,CAAE,OAAOA,EAAO,UAAUH,CAAQ,CAAG,CAAC,EACxF,OAAO,UAAY,CAAE,OAAOS,EAAc,QAAQ,SAAUC,EAAa,CAAE,OAAOA,EAAY,CAAG,CAAC,CAAG,CACzG,CACA,QAAQ,OAAS,OACjB,SAAS,QAAQC,EAAU,CACvB,IAAIC,EAAK,SAASD,CAAQ,EAAGH,EAAUI,EAAG,QAASN,EAAMM,EAAG,IACxDT,EAAS,IAAIG,CAAG,EAChBN,EAAW,UAAY,CAAE,OAAOG,EAAO,IAAIQ,EAAS,CAAC,CAAG,EACxDF,EAAgBD,EAAQ,IAAI,SAAUL,EAAQ,CAAE,OAAOA,EAAO,UAAUH,CAAQ,CAAG,CAAC,EACxF,OAAAG,EAAO,QAAU,UAAY,CAAE,OAAOM,EAAc,QAAQ,SAAUC,EAAa,CAAE,OAAOA,EAAY,CAAG,CAAC,CAAG,EACxGP,CACX,CACA,QAAQ,QAAU",
  "names": ["newValue", "callback", "_this", "initialValue", "signal", "fn", "oldRoot", "ret", "newRoot", "signals", "unsubscribers", "unsubscribe", "deriveFn", "_a"]
}
